!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@angular/core"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-webstorage",["exports","rxjs/operators","@angular/core","rxjs","@angular/common"],t):t((e=e||self)["ngx-webstorage"]={},e.rxjs.operators,e.ng.core,e.rxjs,e.ng.common)}(this,function(e,t,n,r,o){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var c={Local:"local_strategy",Session:"session_strategy",InMemory:"in_memory_strategy"},f=function(){function e(){}return e.isStorageAvailable=function(e){var t=!0;try{"object"==typeof e?(e.setItem("test-storage","foobar"),e.removeItem("test-storage")):t=!1}catch(n){t=!1}return t},e}();function l(){}var g=function(){function e(){}return e.normalize=function(t){return t=e.isCaseSensitive?t:t.toLowerCase(),""+e.prefix+e.separator+t},e.isNormalizedKey=function(t){return 0===t.indexOf(e.prefix+e.separator)},e.setPrefix=function(t){e.prefix=t},e.setSeparator=function(t){e.separator=t},e.setCaseSensitive=function(t){e.isCaseSensitive=t},e.consumeConfiguration=function(e){"prefix"in e&&this.setPrefix(e.prefix),"separator"in e&&this.setSeparator(e.separator),"caseSensitive"in e&&this.setCaseSensitive(e.caseSensitive)},e.prefix="ngx-webstorage",e.separator="|",e.isCaseSensitive=!1,e}(),p=function(){function e(e){this.strategy=e}return e.prototype.retrieve=function(e){var t;return this.strategy.get(g.normalize(e)).subscribe(function(e){return t=void 0===e?null:e}),t},e.prototype.store=function(e,t){return this.strategy.set(g.normalize(e),t).subscribe(l),t},e.prototype.clear=function(e){e!==undefined?this.strategy.del(g.normalize(e)).subscribe(l):this.strategy.clear().subscribe(l)},e.prototype.getStrategyName=function(){return this.strategy.name},e.prototype.observe=function(e){var n=this;return e=g.normalize(e),this.strategy.keyChanges.pipe(t.filter(function(t){return null===t||t===e}),t.switchMap(function(){return n.strategy.get(e)}),t.distinctUntilChanged(),t.shareReplay())},e}(),y=function(){function e(e){this.strategy=e}return e.prototype.retrieve=function(e){return this.strategy.get(g.normalize(e)).pipe(t.map(function(e){return void 0===e?null:e}))},e.prototype.store=function(e,t){return this.strategy.set(g.normalize(e),t)},e.prototype.clear=function(e){return e!==undefined?this.strategy.del(g.normalize(e)):this.strategy.clear()},e.prototype.getStrategyName=function(){return this.strategy.name},e.prototype.observe=function(e){var n=this;return e=g.normalize(e),this.strategy.keyChanges.pipe(t.filter(function(t){return null===t||t===e}),t.switchMap(function(){return n.strategy.get(e)}),t.distinctUntilChanged(),t.shareReplay())},e}(),h=function(){function e(){this.caches={}}return e.prototype.get=function(e,t){return this.getCacheStore(e)[t]},e.prototype.set=function(e,t,n){this.getCacheStore(e)[t]=n},e.prototype.del=function(e,t){delete this.getCacheStore(e)[t]},e.prototype.clear=function(e){this.caches[e]={}},e.prototype.getCacheStore=function(e){return e in this.caches?this.caches[e]:this.caches[e]={}},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),d=new n.InjectionToken("window_local_storage");function m(){return"undefined"!=typeof window?window.localStorage:null}var S={provide:d,useFactory:m},v=new n.InjectionToken("window_session_storage");function b(){return"undefined"!=typeof window?window.sessionStorage:null}var x={provide:v,useFactory:b},I=function(){function e(e,t){this.storage=e,this.cache=t,this.keyChanges=new r.Subject}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return this._isAvailable===undefined&&(this._isAvailable=f.isStorageAvailable(this.storage)),this._isAvailable},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var t=this.cache.get(this.name,e);if(t!==undefined)return r.of(t);try{var n=this.storage.getItem(e);null!==n&&(t=JSON.parse(n),this.cache.set(this.name,e,t))}catch(o){console.warn(o)}return r.of(t)},e.prototype.set=function(e,t){var n=JSON.stringify(t);return this.storage.setItem(e,n),this.cache.set(this.name,e,t),this.keyChanges.next(e),r.of(t)},e.prototype.del=function(e){return this.storage.removeItem(e),this.cache.del(this.name,e),this.keyChanges.next(e),r.of(null)},e.prototype.clear=function(){return this.storage.clear(),this.cache.clear(this.name),this.keyChanges.next(null),r.of(null)},e}(),w=function(e){function t(n,r,i,a){var s=e.call(this,n,r)||this;return s.storage=n,s.cache=r,s.platformId=i,s.zone=a,s.name=t.strategyName,o.isPlatformBrowser(s.platformId)&&s.listenExternalChanges(),s}return a(t,e),t.prototype.listenExternalChanges=function(){var e=this;window.addEventListener("storage",function(t){return e.zone.run(function(){if(t.storageArea===e.storage){var n=t.key;null!==n?e.cache.del(e.name,t.key):e.cache.clear(e.name),e.keyChanges.next(n)}})})},t.strategyName=c.Local,t.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[d]}]},{type:h},{type:undefined,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]},{type:n.NgZone}]},t}(I),j=function(e){function t(n,r,i,a){var s=e.call(this,n,r)||this;return s.storage=n,s.cache=r,s.platformId=i,s.zone=a,s.name=t.strategyName,o.isPlatformBrowser(s.platformId)&&s.listenExternalChanges(),s}return a(t,e),t.prototype.listenExternalChanges=function(){var e=this;window.addEventListener("storage",function(t){return e.zone.run(function(){if(t.storageArea===e.storage){var n=t.key;null!==t.key?e.cache.del(e.name,t.key):e.cache.clear(e.name),e.keyChanges.next(n)}})})},t.strategyName=c.Session,t.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[v]}]},{type:h},{type:undefined,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]},{type:n.NgZone}]},t}(I),C=function(){function e(t){this.cache=t,this.keyChanges=new r.Subject,this.isAvailable=!0,this.name=e.strategyName}return e.prototype.get=function(e){return r.of(this.cache.get(this.name,e))},e.prototype.set=function(e,t){return this.cache.set(this.name,e,t),this.keyChanges.next(e),r.of(t)},e.prototype.del=function(e){return this.cache.del(this.name,e),this.keyChanges.next(e),r.of(null)},e.prototype.clear=function(){return this.cache.clear(this.name),this.keyChanges.next(null),r.of(null)},e.strategyName=c.InMemory,e.ctorParameters=function(){return[{type:h,decorators:[{type:n.Inject,args:[h]}]}]},e}(),_=new n.InjectionToken("STORAGE_STRATEGIES"),k=[{provide:_,useClass:C,multi:!0},{provide:_,useClass:w,multi:!0},{provide:_,useClass:j,multi:!0}],O="stub_strategy",A=function(){function e(e){this.keyChanges=new r.Subject,this.store={},this._available=!0,this.name=e||O}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return this._available},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return r.of(this.store[e])},e.prototype.set=function(e,t){return this.store[e]=t,this.keyChanges.next(e),r.of(t)},e.prototype.del=function(e){return delete this.store[e],this.keyChanges.next(e),r.of(null)},e.prototype.clear=function(){return this.store={},this.keyChanges.next(null),r.of(null)},e.ctorParameters=function(){return[{type:String,decorators:[{type:n.Optional}]}]},e}(),P=function(){function e(){this.store={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.store).length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.store={}},e.prototype.getItem=function(e){return this.store[e]||null},e.prototype.key=function(e){return Object.keys(this.store)[e]},e.prototype.removeItem=function(e){delete this.store[e]},e.prototype.setItem=function(e,t){this.store[e]=t},e}(),E=function(){function e(e){this.strategies=e,this.registration$=new r.Subject,e||(e=[]),this.strategies=e.reverse().map(function(e,t,n){return e.name}).map(function(e,t,n){return n.indexOf(e)===t?t:null}).filter(function(e){return null!==e}).map(function(t){return e[t]})}return e.get=function(t){if(!this.isStrategyRegistered(t))throw Error("invalid_strategy");var n=e.index[t];return n.isAvailable||(n=e.index[c.InMemory]),n},e.set=function(t,n){e.index[t]=n},e.clear=function(t){t!==undefined?delete e.index[t]:e.index={}},e.isStrategyRegistered=function(t){return t in e.index},e.hasRegistredStrategies=function(){return Object.keys(e.index).length>0},e.prototype.getStrategy=function(t){return e.get(t)},e.prototype.indexStrategies=function(){var e=this;this.strategies.forEach(function(t){return e.register(t.name,t)})},e.prototype.indexStrategy=function(t,n){if(void 0===n&&(n=!1),e.isStrategyRegistered(t)&&!n)return e.get(t);var r=this.strategies.find(function(e){return e.name===t});if(!r)throw new Error("invalid_strategy");return this.register(t,r,n),r},e.prototype.register=function(t,n,r){void 0===r&&(r=!1),e.isStrategyRegistered(t)&&!r||(e.set(t,n),this.registration$.next(t))},e.index={},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Array,decorators:[{type:n.Optional},{type:n.Inject,args:[_]}]}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(_,8))},token:e,providedIn:"root"}),e}(),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(p);function R(e){var t=e.indexStrategy(c.Local);return new p(t)}var L={provide:N,useFactory:R,deps:[E]},T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(p);function z(e){var t=e.indexStrategy(c.Session);return new p(t)}var M={provide:T,useFactory:z,deps:[E]},F=function(){function e(){}return e.buildSyncStrategyDecorator=function(e,t,n,r,o){void 0===o&&(o=null);var i,a=r||n;function s(){return i!==undefined?i:i=g.normalize(a)}Object.defineProperty(t,n,{get:function(){var t;return E.get(e).get(s()).subscribe(function(e){return t=e}),t===undefined?o:t},set:function(t){E.get(e).set(s(),t).subscribe(l)}})},e}();var D=[L,M],G=new n.InjectionToken("ngx_webstorage_config");function q(e){return e.indexStrategies(),function(){return E.index}}var B=function(){function e(e,t){t?g.consumeConfiguration(t):console.error("NgxWebstorage : Possible misconfiguration (The forRoot method usage is mandatory since the 3.0.0)")}return e.forRoot=function(t){return void 0===t&&(t={}),{ngModule:e,providers:u([{provide:G,useValue:t},S,x],D,k,[{provide:n.APP_INITIALIZER,useFactory:q,deps:[E],multi:!0}])}},e.decorators=[{type:n.NgModule,args:[{}]}],e.ctorParameters=function(){return[{type:E},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[G]}]}]},e}();e.AsyncStorage=y,e.CompatHelper=f,e.InMemoryStorageStrategy=C,e.InvalidStrategyError="invalid_strategy",e.LIB_CONFIG=G,e.LOCAL_STORAGE=d,e.LocalStorage=function(e,t){return function(n,r){F.buildSyncStrategyDecorator(c.Local,n,r,e,t)}},e.LocalStorageService=N,e.LocalStorageStrategy=w,e.NgxWebstorageModule=B,e.SESSION_STORAGE=v,e.STORAGE_STRATEGIES=_,e.SessionStorage=function(e,t){return function(n,r){F.buildSyncStrategyDecorator(c.Session,n,r,e,t)}},e.SessionStorageService=T,e.SessionStorageStrategy=j,e.StorageStrategies=c,e.StorageStrategyStub=A,e.StorageStrategyStubName=O,e.StorageStub=P,e.StrategyCacheService=h,e.StrategyIndex=E,e.SyncStorage=p,e.appInit=q,e.ɵa=m,e.ɵb=S,e.ɵc=b,e.ɵd=x,e.ɵe=k,e.ɵf=R,e.ɵg=L,e.ɵh=z,e.ɵi=M,e.ɵj=I,e.ɵl=_,e.ɵn=D,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-webstorage.umd.min.js.map